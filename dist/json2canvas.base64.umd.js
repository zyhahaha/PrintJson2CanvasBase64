(function(r,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(r=typeof globalThis<"u"?globalThis:r||self,p((r.json2canvas=r.json2canvas||{},r.json2canvas.base64={})))})(this,function(r){"use strict";function p(l,u,h,n,i,t){const o=[],s="";let e="";for(let a=0;a<u.length;a++){const f=u[a];l.measureText(e+f+s).width<i&&f!==`
`?e+=f+s:(f===`
`&&(e+=f,a++),o.push(e),e=f+s)}return o.push(e),o.forEach(a=>{l.fillText(a.trim(),h,n),n+=t}),o.length}function w(l,u,h,n){const i=[],t="";let o="";l.font=`${n}px 宋体`;for(let s=0;s<u.length;s++){const e=u[s];l.measureText(o+e+t).width<h&&e!==`
`?o+=e+t:(e===`
`&&(o+=e,s++),i.push(o),o=e+t)}return i.push(o),i.length}function v(l,u,h){switch(u.textAlign){case"center":return h.width/2;case"end":case"right":return h.width-10;case"start":case"left":default:return 10}}function d(l,u,h,n,i=1){const t=u[l+1];if(!t)return!1;if(l<u.length-1){if(t.position==="absolute"){if(i===1)return;h.value+=(parseInt(n.fontSize)+10)*(i-1);return}n.type==="text"&&n.wrapText&&(h.value+=(parseInt(n.fontSize)+10)*(i-1)),t.type==="text"?h.value+=parseInt(t.fontSize,10)+10:t.type==="barcode"||t.type==="image"?h.value+=t.height:(t.type==="solidLine"||t.type==="dashedLine")&&(h.value+=20)}}function x(l,u,h){if(!document)throw new Error("请在浏览器环境运行!");const n=document.createElement("canvas");n.width=u;let i=0;const t=n.getContext("2d");t.fillStyle="white",t.fillRect(0,0,n.width,n.height);const o=[],s={value:0};return l.forEach((e,a)=>{const f=l[a+1],y=e.maxWidth||n.width;if(t.fillStyle="#231815",t.font=`${e.fontWeight} ${e.fontSize}px 宋体`,a===0&&(s.value=Number(e.fontSize)+20,i+=s.value),e.type==="text"&&o.push(()=>{t.fillStyle=e.color||"#231815",t.font=`${e.fontWeight} ${e.fontSize}px 宋体`,t.textAlign=e.textAlign||"start";let c;e.wrapText?c=p(t,e.content,v(t,e,n),s.value,y,parseInt(e.fontSize,10)+10):t.fillText(e.content,v(t,e,n),s.value),d(a,l,s,e,c)}),(e.type==="solidLine"||e.type==="dashedLine")&&o.push(()=>{t.beginPath(),t.moveTo(0,s.value),t.lineTo(n.width,s.value),t.strokeStyle="#231815",t.lineWidth=e.lineWidth||2,e.type==="solidLine"?t.setLineDash([]):e.type==="dashedLine"&&t.setLineDash([5,5]),t.stroke(),d(a,l,s,e)}),e.type==="image"&&o.push(()=>{t.drawImage(h,n.width/2-e.width/2,s.value-e.height,e.width,e.height),e.image_intro&&(t.font="16px 宋体",t.textAlign="center",t.fillText(e.image_intro,n.width/2,s.value)),d(a,l,s,e)}),a<l.length-1){let c=1;if(e.wrapText&&(c=w(t,e.content,y,e.fontSize)),f.position==="absolute"){if(c===1)return;if(e.type==="text"&&e.wrapText){i+=(parseInt(e.fontSize)+10)*(c-1);return}}e.type==="text"&&e.wrapText&&(i+=(parseInt(e.fontSize)+10)*(c-1)),f.type==="text"?i+=parseInt(f.fontSize,10)+10:f.type==="barcode"||f.type==="image"?i+=f.height:(f.type==="solidLine"||f.type==="dashedLine")&&(i+=20)}}),n.height=i,o.forEach(e=>{e()}),n.toDataURL()}r.PrintJson2CanvasBase64=x,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
