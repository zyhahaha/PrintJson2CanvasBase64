(function(u,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(u=typeof globalThis<"u"?globalThis:u||self,p((u.json2canvas=u.json2canvas||{},u.json2canvas.base64={})))})(this,function(u){"use strict";const p=require("jsbarcode");function g(o,c,a,n,i,t){const l=[],s="";let e="";for(let r=0;r<c.length;r++){const f=c[r];o.measureText(e+f+s).width<i&&f!==`
`?e+=f+s:(f===`
`&&(e+=f,r++),l.push(e),e=f+s)}return l.push(e),l.forEach(r=>{o.fillText(r.trim(),a,n),n+=t}),l.length}function v(o,c,a,n){const i=[],t="";let l="";o.font=`${n}px 宋体`;for(let s=0;s<c.length;s++){const e=c[s];o.measureText(l+e+t).width<a&&e!==`
`?l+=e+t:(e===`
`&&(l+=e,s++),i.push(l),l=e+t)}return i.push(l),i.length}function y(o,c,a){switch(c.textAlign){case"center":return a.width/2;case"end":case"right":return a.width-10;case"start":case"left":default:return 10}}function d(o,c,a,n,i=1){const t=c[o+1];if(!t)return!1;if(o<c.length-1){if(t.position==="absolute"){if(i===1)return;a.value+=(parseInt(n.fontSize)+10)*(i-1);return}n.type==="text"&&n.wrapText&&(a.value+=(parseInt(n.fontSize)+10)*(i-1)),t.type==="text"?a.value+=parseInt(t.fontSize,10)+10:t.type==="barcode"||t.type==="image"?a.value+=t.height:(t.type==="solidLine"||t.type==="dashedLine")&&(a.value+=20)}}function x(o,c,a){if(!document)throw new Error("请在浏览器环境运行!");const n=document.createElement("canvas");n.width=c;let i=0;const t=n.getContext("2d");t.fillStyle="white",t.fillRect(0,0,n.width,n.height);const l=[],s={value:0};return o.forEach((e,r)=>{const f=o[r+1],w=e.maxWidth||n.width;if(t.fillStyle="#231815",t.font=`${e.fontWeight} ${e.fontSize}px 宋体`,r===0&&(s.value=Number(e.fontSize)+20,i+=s.value),e.type==="text"&&l.push(()=>{t.fillStyle=e.color||"#231815",t.font=`${e.fontWeight} ${e.fontSize}px 宋体`,t.textAlign=e.textAlign||"start";let h;e.wrapText?h=g(t,e.content,y(t,e,n),s.value,w,parseInt(e.fontSize,10)+10):t.fillText(e.content,y(t,e,n),s.value),d(r,o,s,e,h)}),(e.type==="solidLine"||e.type==="dashedLine")&&l.push(()=>{t.beginPath(),t.moveTo(0,s.value),t.lineTo(n.width,s.value),t.strokeStyle="#231815",t.lineWidth=e.lineWidth||2,e.type==="solidLine"?t.setLineDash([]):e.type==="dashedLine"&&t.setLineDash([5,5]),t.stroke(),d(r,o,s,e)}),e.type==="barcode"&&l.push(()=>{const h=document.createElement("canvas");h.width=e.width,h.height=e.height,p(h,e.content,{format:"CODE128",lineColor:"#000",displayValue:!0,text:e.content,textMargin:e.textMargin,width:2,height:40,background:""}),e.position==="absolute"?t.drawImage(h,n.width-h.width,s.value-h.height):t.drawImage(h,n.width/2-h.width/2,s.value-h.height),d(r,o,s,e)}),e.type==="image"&&l.push(()=>{t.drawImage(a,n.width/2-e.width/2,s.value-e.height,e.width,e.height),e.image_intro&&(t.font="16px 宋体",t.textAlign="center",t.fillText(e.image_intro,n.width/2,s.value)),d(r,o,s,e)}),r<o.length-1){let h=1;if(e.wrapText&&(h=v(t,e.content,w,e.fontSize)),f.position==="absolute"){if(h===1)return;if(e.type==="text"&&e.wrapText){i+=(parseInt(e.fontSize)+10)*(h-1);return}}e.type==="text"&&e.wrapText&&(i+=(parseInt(e.fontSize)+10)*(h-1)),f.type==="text"?i+=parseInt(f.fontSize,10)+10:f.type==="barcode"||f.type==="image"?i+=f.height:(f.type==="solidLine"||f.type==="dashedLine")&&(i+=20)}}),n.height=i,l.forEach(e=>{e()}),n.toDataURL()}u.PrintJson2CanvasBase64=x,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
